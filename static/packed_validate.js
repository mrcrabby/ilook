(function(g){var a={errorRequired:"此项为必填项",errorTempl:'<span class="validate-error">{msg}</span>',optionTempl:'<span class="validate-option">{msg}</span>',callback:null},c=".item",b=".validate-error",f=".validate-option",d=function(i,j){var h,l={};if(!i||i==={}){return j}for(h in j){if(j.hasOwnProperty(h)){l[h]=i[h]||j[h]}}return l},e=function(j,i,l,h,k){if(!i||!j){return}this._init(j,i,l,h,k)};e.prototype={_init:function(j,i,m,h,l){var k;k=this.node=g(j);this.form=(k.attr("tagName").toLowerCase()==="form")?k:k.find("form");this.config=d(l,a);this.rules=i;this.errorMsg=m||{};this.optionMsg=h||{};k.data("validateForm",this);this._bindEvent()},_bindEvent:function(){if(this.node.data("hasBindValidateEvent")){return}this.node.data("hasBindValidateEvent",true);this.form.submit(g.proxy(function(h){this.validate();this._handleFormSubmit(h)},this)).find("input,select,textarea").bind({blur:g.proxy(function(h){this._handleBlur(h)},this),focus:g.proxy(function(h){this._handleFocus(h)},this)});this._bindRules()},_bindRules:function(){var i=this.rules,h;for(h in i){if(i.hasOwnProperty(h)){g(i[h].elems,this.form).each(function(k,m){var j=g(m),l=j.data("validate-rules")||"";j.data("validate-rules",l+","+h)})}}},_handleBlur:function(o){var j=g(o.target),p=j.parents(c),m,h,n,l,q=false,s=j.data("validate-rules");p.find(f).hide();if(!s){return}s=s.split(",").slice(1);for(m=0,n=s.length;m<n;m++){h=this.rules[s[m]];this.validate(h,this.errorMsg[s[m]],j)}},_handleFocus:function(i){var h=i.target.getAttribute("name"),j;if(!h){return}if(j=this.optionMsg[h.toLowerCase()]){this.displayOptionMsg(g(i.target),j)}},_handleFormSubmit:function(j){var i,h,k=this;i=this.form.find(".has-error");h=this.form.find(".has-process");if(i.length>0){j.preventDefault();return}if(h.length>0){j.preventDefault();setTimeout(function(){try{k._handleFormSubmit(j)}catch(l){}},200);return}if(k.config.callback){k.config.callback(k.form)}else{k.form[0].submit()}},clearErrorMsg:function(h){var i=h.parents(c);i.find(b).hide()},displayError:function(j,l){var k=j.parents(c),i=k.find(f),h=k.find(b);i.hide();if(h.length===0){g(this.config.errorTempl.replace("{msg}",l)).appendTo(k).show();return}h.show().html(l);return},displayOptionMsg:function(j,l){if(!l){return}var k=j.parents(c),i=k.find(f),h=k.hasClass("has-error");if(h){return}if(i.length===0){g(this.config.optionTempl.replace("{msg}",l)).appendTo(k).show();return}i.show().html(l);return},validate:function(n,m,i){var j=this.errorMsg.errorRequired,o=function(w,y,u,x){var v=u.parents(c),s=false,t;if(w.isRequired&&g.trim(u.val())===""){x.displayError(u,j||a.errorRequired);s=true;v.addClass("has-error")}else{for(t in w){if(w.hasOwnProperty(t)&&typeof w[t]==="function"){if(w[t](u,x)){x.displayError(u,y[t]);v.addClass("has-error");s=true;break}}}if(!s){x.clearErrorMsg(u);v.removeClass("has-error")}}},h,q,p,l;if(!n){q=this.rules;p=this.errorMsg;for(l in q){if(q.hasOwnProperty(l)){h=q[l];g(h.elems,this.form).each(g.proxy(function(k,r){o(h,p[l],g(r),this)},this))}}}else{o(n,m,i,this)}}};g.extend({validate:{isEmail:function(h){return/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(h)}}});g.fn.validateForm=function(k,m,j,l){var i=j,h=l;if(arguments.length===3){i=null;h=j}this.each(function(){new e(this,k,m,i,h)});return this}})(jQuery);